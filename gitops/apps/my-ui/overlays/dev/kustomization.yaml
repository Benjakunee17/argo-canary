apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# namespace ของ dev
namespace: my-ui-dev

# ดึง resource จาก base
resources:
  - ../../base

# override image tag ให้ dev (GitHub Actions จะมาแก้ newTag ตรงนี้)
images:
  - name: ghcr.io/benjakuneepong/my-ui
    newTag: dev-initial

# patches สำหรับ dev (ปรับ host / replicas)
patches:
  # เปลี่ยน host ของ ingress เป็น dev
  - target:
      kind: Ingress
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: my-ui-dev.local

  # ลด replicas สำหรับ dev
  - target:
      kind: Rollout
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 2