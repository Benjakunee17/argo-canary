apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: my-ui-prod

resources:
  - ../../base

# ‡πÉ‡∏™‡πà label ‡πÉ‡∏´‡πâ resource ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô prod
labels:
  - pairs:
      env: prod

images:
  - name: ghcr.io/benjakunee17/my-ui
    newName: ghcr.io/benjakunee17/my-ui
    newTag: 017d608

patches:
  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô host ‡πÄ‡∏õ‡πá‡∏ô domain ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á prod
  - target:
      kind: Ingress
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: my-ui.company.com

  # ‡πÄ‡∏û‡∏¥‡πà‡∏° replicas ‡πÉ‡∏´‡πâ prod
  - target:
      kind: Rollout
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 6

  # ‡∏ó‡∏≥ canary ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤ dev
  - target:
      kind: Rollout
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/strategy/canary/steps
        value:
          - setWeight: 5
          - pause:
              duration: 60s
          - setWeight: 20
          - pause:
              duration: 120s
          - setWeight: 50
          - pause:
              duration: 180s
          - setWeight: 100

  # üî• ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏Å‡πâ pod template label ‡∏à‡∏≤‡∏Å dev ‚Üí prod
  - target:
      kind: Rollout
      name: my-ui
    patch: |-
      - op: replace
        path: /spec/template/metadata/labels/env
        value: prod